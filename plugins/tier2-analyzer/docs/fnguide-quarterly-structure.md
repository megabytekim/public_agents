# FnGuide 재무제표 테이블 구조 분석

## URL 패턴

### 기본 URL
```
https://comp.fnguide.com/SVO2/ASP/SVD_Finance.asp?pGB=1&gicode=A{종목코드}
```

### URL 파라미터

| 파라미터 | 설명 | 값 |
|---------|------|-----|
| `pGB` | 페이지 구분 | `1` (재무제표) |
| `gicode` | 종목코드 | `A005930` (삼성전자 예시) |
| `ReportGB` | 재무제표 유형 | `D` (연결), `B` (별도) |
| `MenuYn` | 메뉴 표시 | `N` |
| `NewMenuID` | 메뉴 ID | `103` |
| `stkGb` | 주식 구분 | `701` |

### 예시 URL
- 연결 재무제표: `?pGB=1&gicode=A005930&ReportGB=D`
- 별도 재무제표: `?pGB=1&gicode=A005930&ReportGB=B`

---

## 테이블 구조

### 테이블 ID 매핑

| 테이블 ID | 재무제표 유형 | 기간 구분 |
|----------|-------------|----------|
| `divSonikY` | 포괄손익계산서 | 연간 (Annual) |
| `divSonikQ` | 포괄손익계산서 | 분기 (Quarterly) |
| `divDaechaY` | 재무상태표 | 연간 (Annual) |
| `divDaechaQ` | 재무상태표 | 분기 (Quarterly) |
| `divCashY` | 현금흐름표 | 연간 (Annual) |
| `divCashQ` | 현금흐름표 | 분기 (Quarterly) |

### CSS 클래스
- 테이블: `us_table_ty1 h_fix zigbg_no`
- 주요 항목 행: `rowBold`
- 하위 항목 행: 들여쓰기 `&nbsp;&nbsp;&nbsp;` 포함

---

## 컬럼 형식

### 연간 데이터 (divSonikY, divDaechaY, divCashY)

#### 포괄손익계산서/현금흐름표 (연간)
| 컬럼 | 내용 | 형식 예시 |
|------|------|----------|
| 1 | 항목명 | `매출액`, `영업이익` 등 |
| 2-4 | 과거 3개년 | `2022/12`, `2023/12`, `2024/12` |
| 5 | 최근 누적 | `2025/09` (당해 연도 누적) |
| 6 | 전년동기 | `전년동기` 값 |
| 7 | 전년동기(%) | YoY 성장률 |

#### 재무상태표 (연간)
| 컬럼 | 내용 | 형식 예시 |
|------|------|----------|
| 1 | 항목명 | `자산`, `부채`, `자본` 등 |
| 2-4 | 과거 3개년 | `2022/12`, `2023/12`, `2024/12` |
| 5 | 최근 분기 | `2025/09` |

### 분기 데이터 (divSonikQ, divDaechaQ, divCashQ)

#### 포괄손익계산서 (분기)
| 컬럼 | 내용 | 형식 예시 |
|------|------|----------|
| 1 | 항목명 | `매출액`, `영업이익` 등 |
| 2-5 | 최근 4개 분기 | `2024/12`, `2025/03`, `2025/06`, `2025/09` |
| 6 | 전년동기 | `전년동기` 값 |
| 7 | 전년동기(%) | YoY 성장률 |

#### 재무상태표/현금흐름표 (분기)
| 컬럼 | 내용 | 형식 예시 |
|------|------|----------|
| 1 | 항목명 | `자산`, `영업활동현금흐름` 등 |
| 2-5 | 최근 4개 분기 | `2024/12`, `2025/03`, `2025/06`, `2025/09` |

---

## 날짜 형식

### 연간 결산
- 형식: `YYYY/MM` (예: `2024/12`)
- 대부분 12월 결산 (`/12`)
- 일부 기업 3월, 6월, 9월 결산

### 분기 데이터
- 형식: `YYYY/MM` (예: `2025/03`, `2025/06`, `2025/09`, `2025/12`)
- 분기 종료월 기준: `/03`, `/06`, `/09`, `/12`

---

## 주요 항목 (rowBold 클래스)

### 포괄손익계산서
- `매출액`
- `영업이익`
- `영업이익(발표기준)`
- `세전계속사업이익`
- `당기순이익`

### 재무상태표
- `자산`
- `부채`
- `자본`

### 현금흐름표
- `영업활동으로인한현금흐름`
- `투자활동으로인한현금흐름`
- `재무활동으로인한현금흐름`
- `현금및현금성자산의증가`

---

## 데이터 값 형식

### HTML 구조
```html
<td class="r" title="757,882.69">757,883</td>
```

- `title` 속성: 소수점 포함 원본 값 (억원 단위)
- 텍스트 내용: 정수 표시 값

### 단위
- 기본 단위: **억원**
- 헤더에 `단위 : 억원` 표시

---

## 파싱 전략

### 1. 테이블 선택
```python
# 분기 손익계산서
table = soup.find('div', id='divSonikQ').find('table')

# 연간 재무상태표
table = soup.find('div', id='divDaechaY').find('table')
```

### 2. 헤더 추출
```python
headers = []
for th in table.find('thead').find_all('th'):
    headers.append(th.text.strip())
```

### 3. 데이터 행 추출
```python
rows = []
for tr in table.find('tbody').find_all('tr'):
    cells = tr.find_all(['th', 'td'])
    row_data = []
    for cell in cells:
        # title 속성에서 정확한 값 추출
        value = cell.get('title') or cell.text.strip()
        row_data.append(value)
    rows.append(row_data)
```

### 4. 주요 항목 필터링
```python
# rowBold 클래스로 주요 항목 식별
if 'rowBold' in tr.get('class', []):
    # 주요 재무항목
```

---

## 참고사항

1. **JavaScript 렌더링**: 페이지는 서버 사이드 렌더링으로 curl로 직접 접근 가능
2. **쿠키 설정**: 연간/분기 전환은 쿠키로 저장 (`finance_cook_sonkiYQ` 등)
3. **차트 이미지**: 별도 CDN에서 제공 (`https://cdn.fnguide.com/SVO2/chartImg/`)
4. **접힘 기능**: 하위 항목은 `acd_dep_start_close` 클래스로 접힘 처리
