# Stock Analyzer Tier 2 - 기획 문서

> 최종 업데이트: 2026-01-17

## 개요

Tier 1 (`stock-analyzer-advanced`)의 1차 스크리닝을 기반으로, **심층 펀더멘털 분석**을 수행하는 Tier 2 에이전트 시스템.

---

## 전체 에이전트 아키텍처 (7개)

```
┌─────────────────────────────────────────────────────────────────┐
│                         TIER 1 (스크리닝)                        │
│                    plugins/stock-analyzer-advanced               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│    ┌────────┐    ┌────────┐    ┌────────┐    ┌────────┐        │
│    │   MI   │    │   SI   │    │   TI   │    │   FI   │        │
│    │ (뉴스) │    │(종토방)│    │(기술적)│    │(연간)  │        │
│    └────────┘    └────────┘    └────────┘    └────────┘        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ Tier 1 분석 완료 후
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         TIER 2 (심층분석)                        │
│                    plugins/tier2-analyzer                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│    ┌──────────────┐   ┌──────────────┐   ┌──────────────┐      │
│    │     FI+      │   │     SI+      │   │     MI+      │      │
│    ├──────────────┤   ├──────────────┤   ├──────────────┤      │
│    │ 분기 재무    │   │ 텔레그램     │   │ 경영진 평가  │      │
│    │ + 동종비교   │   │ 센티먼트     │   │ + DART 공시  │      │
│    │ (VI 흡수)    │   │              │   │ (DART 흡수)  │      │
│    └──────────────┘   └──────────────┘   └──────────────┘      │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Tier 1 vs Tier 2

| 구분 | Tier 1 | Tier 2 |
|------|--------|--------|
| 목적 | 1차 스크리닝 | 심층 분석 |
| 에이전트 | 4개 (MI, SI, TI, FI) | 3개 (FI+, SI+, MI+) |
| 속도 | 5-10분 | 20-30분 |
| 깊이 | 현재 스냅샷 | 시계열 + 정성적 |
| 산출물 | `stock_checklist/` | `tier2/` |

### 에이전트 융합 결정 근거

| Tier 2 | 흡수한 기능 | 융합 이유 |
|--------|-------------|----------|
| **FI+** | VI (동종업계 비교) | PER/PBR 비교 = 재무 데이터 기반, 동일 소스 |
| **MI+** | DART (공시 분석) | 사업보고서 = 경영진 정보의 1차 소스 |
| **SI+** | - | 텔레그램은 완전히 새로운 데이터 소스 |

---

## Tier 2 에이전트 상세

---

### 1. FI+ (Financial Intelligence Plus)

**역할**: 분기 재무 + 동종업계 밸류에이션 비교

#### 기능 범위

```
┌─────────────────────────────────────────┐
│ FI+ = 기존 FI 심화 + VI (동종비교)       │
├─────────────────────────────────────────┤
│ [분기 재무]                              │
│ • 최근 8분기 손익 (2023Q1 ~ 2025Q1)     │
│ • QoQ, YoY 성장률                       │
│ • 컨센서스 vs 실적 서프라이즈            │
│                                          │
│ [동종업계 비교] ← VI 흡수                │
│ • 섹터 평균 PER/PBR/ROE                 │
│ • 피어 그룹 밸류에이션 테이블            │
│ • 프리미엄/디스카운트 분석               │
└─────────────────────────────────────────┘
```

#### 수집 대상

| 카테고리 | 항목 | 소스 |
|----------|------|------|
| **분기 손익** | 매출, 영업이익, 순이익 | FnGuide 분기 |
| **수익성** | 영업이익률, ROE, ROIC | FnGuide |
| **성장성** | QoQ, YoY, CAGR | 계산 |
| **현금흐름** | 영업CF, FCF | DART API |
| **컨센서스** | 추정치, 서프라이즈 | FnGuide, 증권사 |
| **피어 비교** | 동종 PER/PBR | FnGuide 섹터 |

#### 피어 비교 출력 예시

```markdown
## 동종업계 밸류에이션 비교

### 핀테크 섹터 (2026-01-17 기준)

| 종목 | 시총 | PER | PBR | ROE | 매출성장률 |
|------|------|-----|-----|-----|-----------|
| 카카오페이 | 6.7조 | 33.2x | 3.6x | 10.8% | +24.5% |
| 네이버페이 | - | 28.5x | 2.8x | 12.1% | +18.2% |
| 토스 (비상장) | 10조+ | N/A | N/A | N/A | +35% |
| **섹터 평균** | - | **30.2x** | **3.1x** | **11.5%** | **+22%** |

### 밸류에이션 판단
- 카카오페이 PER 33.2x vs 섹터 평균 30.2x = **10% 프리미엄**
- 프리미엄 근거: MAU 1위, 스테이블코인 기대
- 리스크: 성장률 둔화 시 디레이팅 가능
```

#### 구현 방향

```python
# utils/financial_scraper.py 확장

def get_fnguide_quarterly(ticker: str) -> Optional[dict]:
    """FnGuide 분기 재무제표"""
    pass

def get_sector_valuation(sector: str) -> Optional[dict]:
    """섹터 평균 밸류에이션"""
    pass

def get_peer_comparison(ticker: str, peers: list) -> Optional[dict]:
    """피어 그룹 비교"""
    pass
```

#### 체크리스트

- [ ] FnGuide 분기 테이블 구조 분석
- [ ] `get_fnguide_quarterly()` 구현
- [ ] DART API 연동 (현금흐름)
- [ ] 섹터 평균 계산 로직
- [ ] 피어 비교 테이블 생성
- [ ] 테스트 케이스 작성

---

### 2. SI+ (Sentiment Intelligence Plus)

**역할**: 텔레그램 채널 센티먼트 수집

#### 기능 범위

```
┌─────────────────────────────────────────┐
│ SI+ = 텔레그램 데이터 소스 추가          │
├─────────────────────────────────────────┤
│ [채널 수집]                              │
│ • 증권사 리서치 채널                     │
│ • 개인 리딩방                            │
│ • 뉴스봇 채널                            │
│ • 투자자 커뮤니티                        │
│                                          │
│ [분석]                                   │
│ • 채널별 센티먼트 점수                   │
│ • 루머 vs 팩트 분류                      │
│ • 이상 징후 탐지                         │
└─────────────────────────────────────────┘
```

#### 수집 대상 채널 유형

| 유형 | 예시 | 수집 내용 |
|------|------|----------|
| **증권사 리서치** | 공식 리서치 채널 | 목표가, 투자의견 |
| **개인 리딩방** | 주식 전문 채널 | 종목 추천, 매매 신호 |
| **뉴스 봇** | 실시간 뉴스 채널 | 속보, 공시 알림 |
| **커뮤니티** | 투자자 토론방 | 센티먼트, 루머 |

#### 기술 스택

```python
# 권장: Telethon (MTProto, 채널 읽기 지원)
from telethon import TelegramClient

async def collect_channel_messages(channel: str, limit: int = 100):
    """특정 채널의 최근 메시지 수집"""
    pass

def analyze_telegram_sentiment(messages: list, ticker: str) -> dict:
    """메시지에서 종목 관련 센티먼트 분석"""
    pass
```

#### 출력 예시

```markdown
## 텔레그램 센티먼트 분석

### 채널별 점수

| 채널 | 유형 | 언급 수 | 센티먼트 | 신뢰도 |
|------|------|---------|----------|--------|
| @stock_research | 리서치 | 12 | +1.5 | High |
| @daily_stock | 리딩방 | 45 | +0.8 | Medium |
| @rumor_alert | 커뮤니티 | 23 | -0.5 | Low |

### 주요 메시지 요약
- **Bullish**: "카카오페이 스테이블코인 선점 기대" (3회 언급)
- **Bearish**: "알리페이 오버행 주의" (2회 언급)

### 루머 체크
- [ ] "2월 대규모 제휴 발표" - 출처 불명, 검증 필요
```

#### 체크리스트

- [ ] Telethon 설정 및 인증
- [ ] 수집 대상 채널 리스트 확보
- [ ] 메시지 파싱 로직 (종목코드 추출)
- [ ] 센티먼트 점수 계산
- [ ] 루머 분류 로직
- [ ] SI 에이전트 통합

---

### 3. MI+ (Management Intelligence Plus)

**역할**: 경영진 평가 + DART 공시 분석

#### 기능 범위

```
┌─────────────────────────────────────────┐
│ MI+ = 경영진 평가 + DART 공시 (흡수)     │
├─────────────────────────────────────────┤
│ [경영진 평가]                            │
│ A. 경영진 이력/역량 (30%)                │
│ B. 주주 친화성 (40%) ← 버핏 핵심         │
│ C. 지배구조/리스크 (30%)                 │
│                                          │
│ [DART 공시 분석] ← 흡수                  │
│ • 사업보고서 자동 파싱                   │
│ • 주요사항보고서 (M&A, 유증)             │
│ • 내부자 거래 현황                       │
│ • 관계사 거래 분석                       │
└─────────────────────────────────────────┘
```

#### A. 경영진 이력/역량 (Competence) - 30%

| 평가 항목 | 데이터 소스 | 점수 기준 |
|----------|------------|----------|
| CEO 경력 | DART 사업보고서 | 업계 경험 연수 |
| 이전 성과 | 뉴스, IR | 과거 회사 성과 |
| 전문성 | 학력, 경력 | 업종 적합성 |
| 재임 기간 | DART | 안정성 (3년+) |
| 핵심 의사결정 | 뉴스, 공시 | M&A 성공률 |

#### B. 주주 친화성 (Shareholder Friendliness) - 40%

| 평가 항목 | 데이터 소스 | 점수 기준 |
|----------|------------|----------|
| 자사주 매입 | DART 공시 | 최근 3년 이력 |
| 자사주 소각 | DART 공시 | 소각 비율 |
| 배당 정책 | 재무제표 | 배당성향, DPS 성장 |
| 배당 일관성 | 10년 이력 | 연속 배당 연수 |
| 경영진 지분 | 사업보고서 | CEO 지분율 |
| 스톡옵션 | 사업보고서 | 희석 정도 |
| 주주서한 | IR | 소통 품질 |
| IR 투명성 | IR 자료 | 정보 공개 수준 |

#### C. 지배구조/리스크 (Governance & Risk) - 30%

| 평가 항목 | 데이터 소스 | 점수 기준 |
|----------|------------|----------|
| 대주주 지분율 | 사업보고서 | 30-50% 적정 |
| 오너리스크 | 뉴스, 법원 | 소송, 횡령, 배임 |
| 이사회 독립성 | 사업보고서 | 사외이사 비율 |
| 감사위원회 | 사업보고서 | 독립성, 전문성 |
| 내부자 거래 | DART | 비정상 매도 |
| 관계사 거래 | 사업보고서 | 일감 몰아주기 |
| 규제 리스크 | 뉴스, 공시 | 과징금, 제재 이력 |
| ESG 리스크 | ESG 평가 | 환경/사회/지배구조 |

#### DART 공시 분석 (흡수된 기능)

| 공시 유형 | 활용 | 연결 평가 항목 |
|----------|------|---------------|
| **사업보고서** | CEO 이력, 지배구조 | A, C |
| **분기보고서** | 관계사 거래 | C |
| **주요사항** | 유상증자, M&A | A, B |
| **내부자 거래** | 경영진 매수/매도 | B, C |

#### 종합 점수 체계

```markdown
## Management Intelligence Score

| 영역 | 가중치 | 점수 | 가중 점수 |
|------|--------|------|----------|
| A. 경영진 역량 | 30% | 8/10 | 2.4 |
| B. 주주 친화성 | 40% | 9/10 | 3.6 |
| C. 지배구조 | 30% | 7/10 | 2.1 |
| **종합** | 100% | - | **8.1/10** |

### 등급 기준
| 점수 | 등급 | 해석 |
|------|------|------|
| 9-10 | A+ | 버핏이 좋아할 경영진 |
| 8-9 | A | 우수한 경영진 |
| 7-8 | B+ | 양호 |
| 6-7 | B | 보통 |
| 5-6 | C | 주의 필요 |
| <5 | D | 투자 회피 권고 |
```

#### 데이터 소스

| 소스 | 데이터 유형 | 접근 방법 |
|------|------------|----------|
| **DART** | 사업보고서, 공시 | OpenDART API |
| **금감원** | 감사보고서 | 웹 스크래핑 |
| **뉴스** | CEO 관련 기사 | WebSearch |
| **법원** | 소송 이력 | 대법원 사이트 |
| **IR** | 주주서한, PT | 기업 IR 페이지 |
| **ESG** | ESG 평가 | 한국ESG기준원 |

#### 체크리스트

- [ ] OpenDART API 연동
- [ ] 사업보고서 파싱 로직 (임원 현황)
- [ ] 자사주/배당 이력 수집
- [ ] 내부자 거래 분석
- [ ] CEO 스코어카드 템플릿
- [ ] 지배구조 체크리스트 자동화
- [ ] 종합 점수 계산 로직

---

## Tier 2 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│                    /deep-analyze                         │
│              (Tier 2 Orchestrator Command)               │
└─────────────────────────────────────────────────────────┘
           │              │              │
           ▼              ▼              ▼
    ┌───────────┐   ┌───────────┐   ┌───────────┐
    │    FI+    │   │    SI+    │   │    MI+    │
    │ 분기재무  │   │ 텔레그램  │   │ 경영진    │
    │ +피어비교 │   │ 센티먼트  │   │ +DART     │
    └───────────┘   └───────────┘   └───────────┘
           │              │              │
           └──────────────┴──────────────┘
                          │
                          ▼
              ┌─────────────────────┐
              │   Deep Analysis     │
              │   Report 생성       │
              └─────────────────────┘
                          │
                          ▼
              tier2/{종목명}_{코드}/
                  └── summary.md
```

---

## 우선순위 로드맵

### Phase 1: FI+ (분기 재무 + 피어 비교)
- [ ] FnGuide 분기 테이블 구조 분석
- [ ] `get_fnguide_quarterly()` 구현
- [ ] DART API 연동 (현금흐름)
- [ ] 섹터 밸류에이션 수집
- [ ] 피어 비교 테이블 생성
- [ ] 테스트 및 검증

### Phase 2: MI+ (경영진 + DART 공시)
- [ ] OpenDART API 연동
- [ ] 사업보고서 파싱 (임원 현황)
- [ ] 자사주/배당 이력 수집
- [ ] 내부자 거래 분석
- [ ] CEO 스코어카드 생성
- [ ] 지배구조 체크리스트

### Phase 3: SI+ (텔레그램)
- [ ] Telethon 설정 및 인증
- [ ] 채널 리스트 확보
- [ ] 메시지 파싱 로직
- [ ] 센티먼트 분석
- [ ] SI 통합

### Phase 4: 통합
- [ ] `/deep-analyze` 커맨드 생성
- [ ] Tier 1 → Tier 2 연계 워크플로우
- [ ] 리포트 템플릿 확정
- [ ] 전체 테스트

---

## 디렉토리 구조

```
plugins/tier2-analyzer/        # 플러그인 코드
├── TIER2_PLAN.md              # 본 문서
├── overview.md                # 플러그인 개요
├── agents/
│   ├── fi-plus.md             # FI+ 에이전트
│   ├── si-plus.md             # SI+ 에이전트
│   └── mi-plus.md             # MI+ 에이전트
├── commands/
│   └── deep-analyze.md        # 심층 분석 커맨드
├── utils/
│   ├── dart_api.py            # DART API 래퍼
│   ├── telegram_collector.py  # 텔레그램 수집
│   └── peer_comparison.py     # 피어 비교
├── config/
│   └── telegram_channels.json # 텔레그램 채널 설정
└── tests/
    └── ...

tier2/                         # 분석 결과 출력
├── 서진시스템_178320/
│   └── summary.md
├── 카카오페이_377300/
│   └── summary.md
└── ...
```

---

## 참고

- Tier 1 플러그인: `plugins/stock-analyzer-advanced/`
- Tier 2 플러그인: `plugins/tier2-analyzer/`
- 분석 결과:
  - Tier 1: `stock_checklist/{종목명}_{코드}/`
  - Tier 2: `tier2/{종목명}_{코드}/`
